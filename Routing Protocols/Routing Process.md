# 1. 라우팅 개요

### **라우팅(Routing)이란 패킷이 출발지에서 목적지까지 도달하도록 각 라우터가 다음 경로(Next Hop)를 결정하며 전달하는 과정이다.**

- 적용 계층: **네트워크 계층 (OSI 3계층)**
- 기준 정보: **목적지 IP 주소**
- 사용 주체: **라우터, L3 스위치, 호스트의 네트워크 스택**
- 핵심 역할: **경로 선택(Route Selection) + 패킷 전달(Forwarding)**
- IP 주소 기반 논리적 경로 결정
- MAC 주소는 홉마다 변경, IP 주소는 유지

---

# 2. 라우팅 전체 동작 과정

1. **출발지 호스트에서 패킷 생성**
2. **목적지 IP 주소 확인**
3. **같은 네트워크인지 판단**
4. **다르면 기본 게이트웨이로 전달**
5. **라우터에서 라우팅 테이블 조회**
6. **최적 경로(Next Hop) 선택**
7. **다음 라우터로 패킷 전달**
8. 목적지 네트워크 도달할 때까지 반복
9. **최종 목적지 호스트로 패킷 전달**

---

# 3. 출발지 호스트에서의 동작

- 애플리케이션이 통신 요청 생성 (예: 웹 브라우저)
- DNS를 통해 목적지 도메인을 IP 주소로 변환
- 운영체제가 IP 패킷 생성

패킷 기본 정보:
- Source IP : 출발지 호스트 IP
- Destination IP : 목적지 서버 IP

---

# 4. 같은 네트워크 여부 판단

- 출발지 호스트는 목적지 IP가 자신의 네트워크에 속하는지 판단한다.

### 예시
- 내 IP: 192.168.1.10/24
- 목적지 IP: 192.168.1.20 → 같은 네트워크
- 목적지 IP: 8.8.8.8 → 다른 네트워크

### 판단 기준
- **서브넷 마스크를 이용한 네트워크 주소 비교**

---

# 5. 기본 게이트웨이로 전달

- 목적지가 다른 네트워크일 경우
- 패킷을 **기본 게이트웨이(Default Gateway)** 로 전송

### 이때의 특징:
- IP 헤더: **변경 없음**
- MAC 주소: **게이트웨이의 MAC 주소로 변경**

- **라우팅 과정에서 IP는 유지되고 MAC만 홉마다 변경됨**

---

# 6. 라우터의 라우팅 결정 과정

- 라우터는 패킷을 수신하면 다음 순서로 처리한다.

1. **Destination IP 확인**
2. **라우팅 테이블(Routing Table) 조회**
3. **Longest Prefix Match 적용**
4. **최적 경로(Next Hop) 선택**

### 라우팅 테이블 예시
```text
- 10.0.0.0/8        → eth0
- 192.168.1.0/24   → eth1
- 0.0.0.0/0        → 203.0.113.1
```
- 가장 구체적인 프리픽스가 우선 선택됨

---

# 7. 다음 홉(Next Hop)으로 전달

- 선택된 경로의 다음 라우터로 패킷 전달
- 프레임 재작성:
  - Source MAC: 현재 라우터
  - Destination MAC: 다음 홉 라우터
- IP 헤더는 그대로 유지

- 이 과정은 **Hop-by-Hop 방식**으로 반복된다.

---

# 8. 목적지 네트워크 도달 과정

### 마지막 라우터에서:
- 목적지 IP가 자신의 직접 연결 네트워크임을 인식
- ARP를 통해 목적지 호스트의 MAC 주소 조회
- 패킷을 최종 목적지 호스트로 전달

---

# 9. 목적지 호스트 처리

- 목적지 호스트가 패킷 수신
- IP → TCP/UDP → 애플리케이션 계층으로 전달
- 응답 패킷은 **역방향으로 동일한 라우팅 과정 반복**
