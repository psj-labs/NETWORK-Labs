# IGMPv3 Packet Structures (Query & Membership Report)

```text
################################################################################
                                 IGMPv3 Query
################################################################################

┌─────────────────────────┬────────────────────────────┬─────────────────────────┐
│          Type           │   Maximum Response Code    │          Checksum       │
│         (0x11)          │          (1 byte)          │         (2 bytes)       │
└─────────────────────────┴────────────────────────────┴─────────────────────────┘

┌──────────────────────────────────────────────────────────────────────────────┐
│                             Group Address (4 bytes)                          │
└──────────────────────────────────────────────────────────────────────────────┘

┌───────────────┬───┬─────┬───────────────────┬───────────────────────────────┐
│   Reserved    │ S │ QRV │        QQIC       │      Number of Sources (N)    │
│    (4 bits)   │1b │ 3b  │      (1 byte)     │          (2 bytes)            │
└───────────────┴───┴─────┴───────────────────┴───────────────────────────────┘

┌──────────────────────────────────────────────────────────────────────────────┐
│                         Source Address [1]  (4 bytes)                        │
└──────────────────────────────────────────────────────────────────────────────┘
┌──────────────────────────────────────────────────────────────────────────────┐
│                         Source Address [2]  (4 bytes)                        │
└──────────────────────────────────────────────────────────────────────────────┘
│                                       ...                                    │
┌──────────────────────────────────────────────────────────────────────────────┐
│                         Source Address [N]  (4 bytes)                        │
└──────────────────────────────────────────────────────────────────────────────┘


Type (1 byte)
 : 메시지 타입
   예시 → 0x11 (Membership Query)

Maximum Response Code (1 byte)
 : 최대 응답 대기 시간
   예시 → 100 → 10초

Checksum (2 bytes)
 : IGMP 패킷 오류 검출값

Group Address (4 bytes)
 : IPv4 멀티캐스트 그룹 주소
   예시 → 224.0.0.1

Reserved (4 bits)
 : 항상 0

S (1 bit)
 : 쿼리 처리 억제(Suppress) 플래그
   일반적으로 0

QRV (3 bits) – Query Robustness Variable
 : 쿼리 견고성 계수

QQIC (1 byte) – Query Interval Code
 : 쿼리 전송 주기 값

Number of Sources (N) (2 bytes)
 : 이어지는 Source Address 개수
   예시 → 1

Source Address [1..N] (each 4 bytes)
 : 쿼리에 포함된 발신지 IP
   예시 → 10.10.10.10



################################################################################
                            IGMPv3 Membership Report
################################################################################

┌─────────────────────────┬───────────────────────┬───────────────────────────┐
│           Type          │        Reserved       │           Checksum        │
│          (0x22)         │         (1 byte)      │          (2 bytes)        │
└─────────────────────────┴───────────────────────┴───────────────────────────┘

┌──────────────────────────────────────────────────────────────────────────────┐
│                      Number of Group Records (2 bytes)                       │
└──────────────────────────────────────────────────────────────────────────────┘

┌================================================================================┐
│                                Group Record [1]                                │
└================================================================================┘
│                                        ...                                     │
┌================================================================================┐
│                                Group Record [N]                                │
└================================================================================┘


Type (1 byte)
 : 메시지 타입
   예시 → 0x22 (IGMPv3 Membership Report)

Reserved (1 byte)
 : 항상 0

Checksum (2 bytes)
 : IGMP 패킷 오류 검출값

Number of Group Records (2 bytes)
 : Report에 포함된 멀티캐스트 그룹 레코드 수
   예시 → 1



################################################################################
                              Group Record Structure
################################################################################

┌──────────────────┬──────────────────┬───────────────────────────────┐
│   Record Type    │   Aux Data Len   │      Num of Sources (M)       │
│    (1 byte)      │     (1 byte)     │          (2 bytes)            │
└──────────────────┴──────────────────┴───────────────────────────────┘

┌──────────────────────────────────────────────────────────────────────────────┐
│                          Group Address (4 bytes)                             │
└──────────────────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────────────────┐
│                         Source Address [1]  (4 bytes)                        │
└──────────────────────────────────────────────────────────────────────────────┘
│                                     ...                                      │
┌──────────────────────────────────────────────────────────────────────────────┐
│                         Source Address [M]  (4 bytes)                        │
└──────────────────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────────────────┐
│                             Auxiliary Data (optional)                        │
└──────────────────────────────────────────────────────────────────────────────┘


Record Type (1 byte)
 : 멀티캐스트 수신 모드 및 변경 동작

   주요 값
     - MODE_IS_INCLUDE
     - MODE_IS_EXCLUDE
     - CHANGE_TO_INCLUDE_MODE
     - CHANGE_TO_EXCLUDE_MODE
     - ALLOW_NEW_SOURCES
     - BLOCK_OLD_SOURCES

Aux Data Len (1 byte)
 : Auxiliary Data 길이
   - 32비트 단위
   - 일반적으로 0

Num of Sources (M) (2 bytes)
 : 그룹에 포함된 발신지 수

Group Address (4 bytes)
 : 제어 대상 멀티캐스트 그룹 주소
   예시 → 232.1.1.1

Source Address [1..M] (each 4 bytes)
 : 그룹에 포함된 발신지 IP
   예시 → 10.10.10.10

Auxiliary Data
 : 옵션 영역 (대부분 사용 없음)
